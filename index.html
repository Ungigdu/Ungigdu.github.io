<!DOCTYPE html>
<html lang="en">
    <head>
        <title>HopManagement</title>
        <script src="./jquery.mini.js"></script>
        <script src="./web3.min.js"></script>
    </head>
    <body>
        <h2>smart contract test field</h2>
        <div id="contract_info">
            <input id="account" style="width: 20%;"/>
            <input id="balance" style="width: 20%;"/>
            <p>abi:</p>
            <textarea id="contract_abi" style="width: 80%;height: 100px;">
            </textarea>
            <p>address:</p>
            <input type="text" id = "contract_address" style="width: 40%;"/>
            <p>name:</p>
            <input type="text" id = "contract_name" />
            <button id="load_contract" onclick="loadContract()">import</button>
        </div>
    </body>

    <script>
         App = {};
        //load web3
        (async()=>{
            // Modern dApp browsers...
            if (window.ethereum) {
                alert("this is modern dApp broswer")
                window.web3 = new Web3(ethereum)
                try {
                    // Request account access if needed
                    await ethereum.enable()
                    // Acccounts now exposed
                    // web3.eth.sendTransaction({/* ... */})
                } catch (error) {
                    // User denied account access...
                }
            }
            // Legacy dApp browsers...
            else if (window.web3) {
                alert("this is legacy dApp browser")
                App.web3Provider = web3.currentProvider
                window.web3 = new Web3(web3.currentProvider)
                // Acccounts always exposed
                // web3.eth.sendTransaction({/* ... */})
            }
            // Non-dApp browsers...
            else {
                alert('Non-Ethereum browser detected. You should consider trying MetaMask!')
            }
            if (typeof web3 !== 'undefined') {
                App.web3Provider = web3.currentProvider
                web3 = new Web3(web3.currentProvider)
            } else {
                window.alert("Please connect to Metamask.")
            }
            var current_account = await web3.eth.getAccounts()
            var balance = await web3.eth.getBalance(current_account[0])
            $("#account").val(current_account[0])
            $("#balance").val(balance)
        })();
        
         function loadContract(){
            console.log("start load contract");
            var abi_data = JSON.parse($("#contract_abi").val());
            var address = $("#contract_address").val();
            var name = $("#contract_name").val();
            App[name] = web3.eth.contract(abi_data).at(address)
        }

        //---------------------------------------------------------------------------------
        //-----------------------------you can add custom code below-----------------------
        //---------------------------------------------------------------------------------
        
        //load bas_token
        _bas_token_abi = [{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burnFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"constant":false,"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"INITIAL_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}];
        _bas_token_address = "0xb9291744e91fAd68060D7Cbfc702f13F64E6E7C5";
        App["bas_token"] = new web3.eth.Contract(_bas_token_abi,_bas_token_address);
        //load bas_data_management_contract
        _bas_data_management_abi = [{"constant":false,"inputs":[{"name":"newPrice","type":"uint256"}],"name":"changePricePureRoot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newPrice","type":"uint256"}],"name":"changePriceRoot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newPrice","type":"uint256"}],"name":"changePriceSubRoot","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hashKey","type":"bytes32"},{"name":"data","type":"bytes"},{"name":"hostAlias","type":"string"},{"name":"additionalInfo","type":"bytes"}],"name":"changeReord","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hashKey","type":"bytes32"},{"name":"to","type":"address"}],"name":"domainApprove","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hashKey","type":"bytes32"},{"name":"y","type":"uint256"}],"name":"extendRent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"key","type":"string"},{"name":"dtype","type":"uint8"},{"name":"y","type":"uint256"},{"name":"data","type":"bytes"},{"name":"hostAlias","type":"string"},{"name":"additionalInfo","type":"bytes"}],"name":"rent","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"hashKey","type":"bytes32"}],"name":"subDomainSwitch","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"key","type":"string"},{"name":"to","type":"address"}],"name":"transferDomainOwnerShip","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"key","type":"string"},{"name":"from","type":"address"},{"name":"to","type":"address"}],"name":"transferDomainOwnerShipFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"tokenAddr","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"key","type":"string"},{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"year","type":"uint256"}],"name":"Rent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"key","type":"string"},{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"}],"name":"TransferDomainOwnerShip","type":"event"},{"anonymous":false,"inputs":[],"name":"Change","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"hashKey","type":"bytes32"},{"indexed":false,"name":"newExpireTime","type":"uint256"}],"name":"ExtendRent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"hashKey","type":"bytes32"}],"name":"DomainApproval","type":"event"},{"constant":true,"inputs":[],"name":"checkTokenAllowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"from","type":"address"},{"name":"hashKey","type":"bytes32"}],"name":"domainApproval","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"domain","type":"string"},{"name":"y","type":"uint256"}],"name":"evalueDomain","outputs":[{"name":"","type":"uint8"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"n","type":"uint256"}],"name":"getMyDomainByIndex","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getMyDomainCounts","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"hashKey","type":"bytes32"}],"name":"getOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"key","type":"string"}],"name":"hash","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"str","type":"string"}],"name":"isPureRoot","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"str","type":"string"}],"name":"isRoot","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"str","type":"string"}],"name":"isSub","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price_pure_root","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price_root","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"price_sub","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"hashKey","type":"bytes32"}],"name":"queryByHash","outputs":[{"name":"","type":"uint8"},{"name":"","type":"bool"},{"name":"","type":"bytes4"},{"name":"","type":"bytes16"},{"name":"","type":"bytes1"},{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"data","type":"bytes"}],"name":"validDataFormat","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"pure","type":"function"}];
        _bas_data_management_address = "0xEC16e816D432414C923d98c653f0237AcC457351";
        App["bas_data_management"] = new web3.eth.Contract(_bas_data_management_abi,_bas_data_management_address);

        //load bptStorageEvent
        _bpt_storage_abi = [{"constant":false,"inputs":[{"internalType":"address","name":"newBF","type":"address"}],"name":"changeBaneficiary","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"m","type":"uint256"},{"internalType":"uint256","name":"y","type":"uint256"},{"internalType":"uint256","name":"y3","type":"uint256"}],"name":"changePrice","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"bytes","name":"data","type":"bytes"}],"name":"commit","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"t","type":"address"},{"internalType":"address","name":"bf","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"sender","type":"address"},{"indexed":false,"internalType":"bytes","name":"data","type":"bytes"}],"name":"Commit","type":"event"},{"constant":false,"inputs":[{"internalType":"uint256","name":"m","type":"uint256"}],"name":"RechargeByMonth","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"uint256","name":"chargeType","type":"uint256"}],"name":"RechargeByType","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"newAdmin","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"allMembership","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"baneficiary","outputs":[{"internalType":"address","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oneMonthCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oneMonthExtend","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oneYearCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oneYearExtend","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"threeYearsCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"threeYearsExtend","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"token","outputs":[{"internalType":"contractERC20","name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"}]
        _bpt_storage_address = "0xbA5466f596A7f3b7114ccBd779e45084fF0B86D8"
        App["bpt_storage_by_event"] = new web3.eth.Contract(_bpt_storage_abi,_bpt_storage_address);
    </script>
</html>